# Test Windows Installation
# This workflow validates that install.bat works correctly on Windows

name: Test Windows Install

on:
  push:
    branches: [main]
    paths:
      - 'install.bat'
      - 'start.bat'
      - 'requirements.txt'
      - 'package.json'
  pull_request:
    branches: [main]
  workflow_dispatch:  # Allow manual trigger

jobs:
  test-windows:
    runs-on: windows-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Display Windows version
        run: |
          echo "Windows Version:"
          systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
      
      # Note: GitHub Windows runners already have Python and Node.js
      # So we skip the auto-install portion and test the venv/npm parts
      
      - name: Verify Python is available
        run: |
          python --version
          where python
      
      - name: Verify Node.js is available
        run: |
          node --version
          npm --version
          where node
      
      - name: Create Python Virtual Environment
        run: |
          echo "Creating virtual environment..."
          python -m venv venv
          echo "Virtual environment created successfully!"
      
      - name: Activate venv and install requirements
        run: |
          echo "Activating virtual environment..."
          .\venv\Scripts\activate
          echo "Installing Python dependencies..."
          pip install -r requirements.txt
          echo "Python dependencies installed!"
      
      - name: Install Node.js dependencies
        run: |
          echo "Installing npm dependencies..."
          npm install
          echo "npm dependencies installed!"
      
      - name: Verify RAG server can start
        run: |
          echo "Testing if rag_server.py can be imported..."
          .\venv\Scripts\activate
          python -c "import rag_server; print('RAG server module loaded successfully!')"
      
      - name: Build check (optional)
        run: |
          echo "Running build check..."
          npm run build || echo "Build step skipped or not configured"
      
      - name: Summary
        run: |
          echo "=========================================="
          echo "âœ… Windows Installation Test PASSED!"
          echo "=========================================="
          echo "- Python venv: Created"
          echo "- pip install: Success"
          echo "- npm install: Success"
          echo "- RAG server: Loadable"
